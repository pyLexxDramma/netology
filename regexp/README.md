## Домашнее задание к лекции 2.2 «Regular expressions»

**Описание:**

Решение задачи по приведению в порядок адресной книги с использованием регулярных выражений и стандартных инструментов Python.  Задача включает форматирование ФИО, телефонов и объединение дублирующихся записей.  Исходные данные берутся из файла `phonebook_raw.csv`, а результат записывается в файл `phonebook.csv`.


1.  **Импортирует необходимые библиотеки:** `csv` для работы с CSV-файлами, `re` для работы с регулярными выражениями, `pprint` для вывода данных.

2.  **Читает данные из `phonebook_raw.csv`:**
    *   Открывает файл `phonebook_raw.csv` в режиме чтения с указанием кодировки `utf-8`.
    *   Использует `csv.reader` для чтения данных из файла, указав разделитель `,`.
    *   Преобразует данные в список списков `contacts_list`.

3.  **Определяет функцию `format_name(contacts)`:**
    *   Принимает список контактов `contacts`.
    *   Итерируется по каждому контакту в списке.
    *   Извлекает первые три элемента списка (Фамилия, Имя, Отчество) в `name_parts`.
    *   Объединяет элементы `name_parts` в строку, разделенную пробелами, а затем разбивает эту строку на список по пробелам, чтобы получить отдельные элементы ФИО.
    *   Записывает элементы ФИО в соответствующие поля контакта:
        *   `contact[0]` = Фамилия.
        *   `contact[1]` = Имя (если есть).
        *   `contact[2]` = Отчество (если есть).

4.  **Определяет функцию `format_phone(contacts)`:**
    *   Принимает список контактов `contacts`.
    *   Итерируется по каждому контакту в списке.
    *   Определяет регулярное выражение `phone_pattern` для поиска и форматирования телефонных номеров.  Регулярное выражение обрабатывает различные форматы телефонов, включая:
        *   Код страны (+7 или 8).
        *   Разделители (пробелы, скобки, дефисы).
        *   Добавочные номера.
    *   Использует `re.search` для поиска телефонного номера в строке с телефоном `contact[5]`.
    *   Если телефонный номер найден:
        *   Форматирует номер в формат `+7(999)999-99-99`.
        *   Добавляет информацию о добавочном номере (если есть) в формате `доб.9999`.
        *   Записывает отформатированный номер в поле `contact[5]`.

5.  **Определяет функцию `merge_duplicates(contacts)`:**
    *   Принимает список контактов `contacts`.
    *   Создает пустой словарь `unique_contacts` для хранения уникальных контактов.  Ключом в словаре является кортеж `(Фамилия, Имя)`.
    *   Итерируется по каждому контакту в списке `contacts`.
    *   Определяет ключ `key` = `(contact[0], contact[1])` (Фамилия, Имя).
    *   Если ключа `key` нет в словаре `unique_contacts`, то добавляет контакт в словарь.
    *   Если ключ `key` уже есть в словаре (т.е., найден дубликат), то объединяет информацию из текущего контакта с информацией в существующем контакте, хранящемся в словаре.  Если в существующем контакте какое-то поле пустое, а в текущем контакте это поле заполнено, то информация из текущего контакта переносится в существующий.
    *   Возвращает список уникальных контактов (значения словаря `unique_contacts`).

6.  **Вызывает функции для форматирования и объединения:**
    *   `format_name(contacts_list)`: Форматирует ФИО.
    *   `format_phone(contacts_list)`: Форматирует телефонные номера.
    *   `contacts_list = merge_duplicates(contacts_list)`: Объединяет дублирующиеся записи.

7.  **Записывает отформатированные данные в `phonebook.csv`:**
    *   Открывает файл `phonebook.csv` в режиме записи с указанием кодировки `utf-8` и `newline=''` (для предотвращения добавления пустых строк).
    *   Использует `csv.writer` для записи данных в файл, указав разделитель `,`.
    *   Использует `datawriter.writerows(contacts_list)` для записи всех контактов в файл.

8. **Выводит отформатированные данные на экран:**
    *   Использует `pprint(contacts_list)` для вывода отформатированных данных на экран.

